---
import type { ContentMediaCover } from "../types";
import { mediaUrl } from "../consts";

type Props = {
  image?: ContentMediaCover | null;
  alt?: string | null;
  fallbackAlt?: string;
};

const { image, alt, fallbackAlt = "" } = Astro.props;

const src =
  mediaUrl(image?.formats?.large?.url) ??
  mediaUrl(image?.formats?.medium?.url) ??
  mediaUrl(image?.formats?.small?.url) ??
  mediaUrl(image?.url);

const resolvedAlt = alt ?? image?.alternativeText ?? fallbackAlt;
const caption = image?.caption;
---

{
  src && (
    <figure class="picture-block">
      <img src={src} alt={resolvedAlt} loading="lazy" />
      {caption ? <figcaption>{caption}</figcaption> : null}
    </figure>
  )
}

<style>
  .picture-block {
    margin: 1.5rem 0;
  }

  .picture-block img {
    width: 100%;
    height: auto;
    display: block;
    border-radius: 12px;
    box-shadow: var(--box-shadow);
  }

  .picture-block figcaption {
    margin-top: 0.6rem;
    color: rgb(var(--gray));
    font-size: 0.95rem;
    text-align: center;
  }
</style>
